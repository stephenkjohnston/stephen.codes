---
import { TITLE } from "astro:env/client";
import { SEO } from "astro-seo";
import BaseLayout from "layouts/BaseLayout.astro";
import getKilobitLanguages from "utils/getKilobitLanguages";
import { slugify } from "utils/slugify";
import getKilobitsByLanguages from "utils/getKilobitsByLanguage";

const kilobitLanguages = await getKilobitLanguages();
const recentKilobitsByLang = await Promise.all(
  kilobitLanguages.map(async (lang) => ({
    language: lang,
    kilobits: await getKilobitsByLanguages(lang, 4),
  }))
);

---

<SEO
  title={`Kilobits &ndash; ${TITLE}`}
  description="Fresh, byte-sized coding tips and tricks delivered weekly — HTML, CSS, JS, and more!"
/>
<BaseLayout>
  <h1>Kilobits</h1>
  <p>
    Fresh, byte-sized coding tips and tricks hit the page weekly — HTML, CSS,
    JS, and beyond!
  </p>
  {
    recentKilobitsByLang.map(({ language, kilobits }) => (
      <h2>
        &lbrack;
        <a href={`/kilobits/${slugify(language)}`}>{language}</a>
        &rbrack;
      </h2>
      <ul>
        {kilobits.map(recentKilobit => (
          <li><a href={`/kilobits/${recentKilobit.id}`}>{recentKilobit.data.title}</a></li>
        ))}
      </ul>
    ))
  }
</BaseLayout>
